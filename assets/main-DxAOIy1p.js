const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Snow-xd8wy1gf.js","assets/preact-DoPIZWeU.js","assets/render-D473Hyb3.js","assets/Snow-BJfsKG8O.css","assets/Place-W8ubVi-x.js","assets/snapshot-DhZPfYCw.js","assets/Place-CCdJ0iqm.css","assets/TopBar-Bqr--zDD.js","assets/TopBar-DvYkkDv6.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,o)=>((t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o)(t,"symbol"!=typeof a?a+"":a,o);import{d as a,w as o,G as n,u as i,x as s,k as l,F as r,y as c,B as u,S as d,R as p,L as v}from"./preact-DoPIZWeU.js";import{C as f,P as h}from"./render-D473Hyb3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const m={},g=function(e,t,a){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));o=Promise.all(t.map((e=>{if((e=function(e){return"/"+e}(e))in m)return;m[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,a&&n.setAttribute("nonce",a),document.head.appendChild(n),t?new Promise(((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}return o.then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))};class y extends f{constructor(e){super(e)}equals(e){return this.toNumber()===e.toNumber()}getReadableColor(){const[e,t,a]=this.toUint8RgbArray();return new y(.299*e+.587*t+.114*a>186?"black":"white")}static getRandom(){return new y(Math.floor(16777215*Math.random()))}}var w=(e=>(e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e))(w||{});class b{constructor(e,a=4){t(this,"_buffer"),t(this,"_size"),this._raw=e,this.bufferPixelDataSize=a}convertRGBAtoRGB(e,{x:t,y:a}){const o=new Uint8ClampedArray(t*a*3);for(let n=0,i=0;n<e.length;n+=4,i+=3)o[i]=e[n],o[i+1]=e[n+1],o[i+2]=e[n+2];return o}async process(){const e=await createImageBitmap(this._raw),t=document.createElement("canvas"),a=t.getContext("2d");t.width=e.width,t.height=e.height,a.drawImage(e,0,0);const o=a.getImageData(0,0,t.width,t.height).data;return this._size=new h(e.width,e.height),this._buffer=3===this.bufferPixelDataSize?this.convertRGBAtoRGB(o,this._size):o,this}get raw(){return this._raw}get buffer(){return this._buffer}get size(){return this._size}getPixel(e){const t=e.x+e.y*this._size.x,[a,o,n,...i]=this._buffer.slice(t*this.bufferPixelDataSize,t*this.bufferPixelDataSize+this.bufferPixelDataSize);return new y(new Uint8Array([a,o,n,0===i.length?255:i[0]]))}setPixel(e,t){const a=(e.x+e.y*this._size.x)*this.bufferPixelDataSize,[o,n,i]=t.toUint8RgbArray();this._buffer[a]=o,this._buffer[a+1]=n,this._buffer[a+2]=i}}const _={defaults:{colors:{background:new y("#282828"),palette:{colors:[new y("#ff0000"),new y("#00ff00"),new y("#0000ff"),new y("#000000"),new y("#ffffff")],selected:new y("#ffffff")}},settings:{enableSnow:!0}},time:{update:{tags:3e4,info:3e4},ws:2e3,shake:200,notificationRemoved:3e3,pixelInfo:500},cooldown:{offset:50,staff:50},shakeAmount:.1,zoom:{defaultLevel:.25,maxLevel:3,minLevelPx:5},discord:{clientId:"970714810905936022",redirectUri:"https://api.pixelbattle.fun/login",scope:["identify","guilds.join","email"]},hover:{outlineSize:.1,scale:1.2},url:{api:"https://api.pixelbattle.fun"},snow:{size:2,amount:100},overlay:{defaultOpacity:60},media:{youtube:["https://youtube.pixelbattle.fun","YouTube канал Pixelate It!"],discord:["https://discord.pixelbattle.fun","Discord-сервер Pixelate It!"],github:["https://github.pixelbattle.fun","GitHub Pixelate It!"],help:["https://help.pixelbattle.fun","Страница помощи"]}};var x=(e=>(e[e.User=0]="User",e[e.Moderator=1]="Moderator",e[e.Admin=2]="Admin",e))(x||{});
/*! js-cookie v3.0.5 | MIT */function P(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)e[o]=a[o]}return e}var S=function e(t,a){function o(e,o,n){if("undefined"!=typeof document){"number"==typeof(n=P({},a,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var s in n)n[s]&&(i+="; "+s,!0!==n[s]&&(i+="="+n[s].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+i}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],o={},n=0;n<a.length;n++){var i=a[n].split("="),s=i.slice(1).join("=");try{var l=decodeURIComponent(i[0]);if(o[l]=t.read(s,l),e===l)break}catch(r){}}return e?o[e]:o}},remove:function(e,t){o(e,"",P({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,P({},this.attributes,t))},withConverter:function(t){return e(P({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});class C{static get(e){return S.get(e)}static set(e,t){S.set(e,t)}static remove(e){S.remove(e,{domain:this.url})}static clear(){Object.keys(S.get()).forEach((e=>S.remove(e,{domain:this.url})))}}t(C,"url",(_.url.api.split("//")[1].includes(":")?"":".")+_.url.api.split("//").slice(-1)[0].split(":")[0].split(".").slice(-2).join("."));const N={user:a(null),profile:a(null),isAuthenticated:o((()=>!1)),isBanned:o((()=>!1)),isStaff:o((()=>!1)),load(){const e=C.get("token"),t=C.get("userid");e&&t&&(N.profile.value={token:e,id:t})},async fetch(){const e=await R.profile();N.user.value=e},login(e,t){N.profile.value={token:e,id:t}},logout(){N.profile.value=null,N.user.value=null,C.clear()}};N.isAuthenticated=o((()=>!!N.profile.value)),N.isBanned=o((()=>{var e;return!!(null==(e=N.user.value)?void 0:e.banned)})),N.isStaff=o((()=>{var e;return((null==(e=N.user.value)?void 0:e.role)??x.User)>=x.Moderator}));const k=n({}),T={notifications:a([]),addNotification(e){T.notifications.value.length>=5&&(T.notifications.value=T.notifications.value.slice(1)),T.notifications.value=[...T.notifications.value,{...e,id:Math.random().toString()}]},removeNotification(e){T.notifications.value=T.notifications.value.filter((t=>t.id!==e))}},A=n({}),I={UserCooldown:{title:"Кулдаун активен (С)",message:"Подождите пару секунд"},RateLimit:{title:"Рейт лимит (С)",message:"Подождите пару секунд"},TokenBanned:{title:"Аккаунт забанен (С)",message:"Ваш аккаунт забанен"},NotAuthorized:{title:"Необходимо авторизоваться (С)",message:"Вы не вошли в дискорд аккаунт"}},E={Banned:{title:"Аккаунт забанен",message:"Ваш аккаунт забанен"},Cooldown:{title:"Подождите пару секунд",message:"Кулдаун активен"},"Not logged":{title:"Необходимо авторизоваться",message:"Вы не вошли в дискорд аккаунт"},"Game ended":{title:"Ждите новой игры",message:"Игра окончена"},SnapshotSuccess:{title:"Снимок холста",message:"Снимок сохранено в буфер обмена"},SnapshotFailed:{title:"Снимок холста",message:"Ваш браузер не поддерживает работу с буфером обмена"}};class R{static fetch(e){var t;const a={"Content-Type":"application/json"};return e.withCredentials&&(a.Authorization=`Bearer ${null==(t=N.profile.value)?void 0:t.token}`),fetch(_.url.api+e.url,{method:e.method,headers:"GET"===e.method?void 0:a,body:e.body?JSON.stringify(e.body):void 0}).then((e=>e.json())).then(R.checkForErrors)}static async post(e,t,a=!1){return R.fetch({url:e,method:"POST",withCredentials:a,body:t})}static async put(e,t,a=!1){return R.fetch({url:e,method:"PUT",withCredentials:a,body:t})}static async get(e,t=!1){return R.fetch({url:e,method:"GET",withCredentials:t})}static processError(e){const t=I[e.reason]??{title:"Неизвестная ошибка (С)",message:e.reason};T.addNotification({...t,type:"error"})}static checkForErrors(e){return"error"in e&&e.error?(R.processError(e),Promise.reject(e)):e}static async pixels(){return fetch(_.url.api+"/pixels.png").then((e=>e.blob()))}static async info(){return R.get("/game")}static async profile(){var e;return R.get(`/users/${null==(e=N.profile.value)?void 0:e.id}`)}static async getPixel(e){return R.get(`/pixels?x=${e.x}&y=${e.y}`)}static async tags(){return R.get("/pixels/tag")}static async putPixel(e){return R.put("/pixels",e,!0)}static async changeTag(e){var t;return R.post(`/users/${null==(t=N.profile.value)?void 0:t.id}/tag`,{tag:e},!0)}}const B={image:a(null),container:a({}),async fetch(){const e=await R.pixels();B.image.value=await new b(e,w.RGB).process()}},O=n({});class z{static set(e,t,a=JSON.stringify){localStorage.setItem(e,a(t))}static get(e,t){const a=localStorage.getItem(e);return a?t?t(JSON.parse(a)):JSON.parse(a):void 0}static reset(e){localStorage.removeItem(e)}}const U={palette:a(_.defaults.colors.palette),reset(){U.palette.value=_.defaults.colors.palette,U.save()},setCurrentColor:e=>{U.palette.value={...U.palette.value,selected:e},U.save()},isDefaultColors:()=>U.palette.value.colors.length===_.defaults.colors.palette.colors.length,removeColor(e){U.palette.value={selected:U.palette.value.colors.at(-2)??U.palette.value.selected,colors:U.palette.value.colors.filter((t=>!t.equals(e)))},U.save()},isDefaultColor:e=>_.defaults.colors.palette.colors.some((t=>t.equals(e))),addColor(e){U.palette.value={...U.palette.value,colors:[...U.palette.value.colors,e]},U.save()},addAndSelect(e){U.palette.value.colors.some((t=>t.equals(e)))||this.addColor(e),this.setCurrentColor(e),U.save()},save(){z.set("palette",{colors:U.palette.value.colors,selected:U.palette.value.selected},(({colors:e,selected:t})=>JSON.stringify({colors:e.map((e=>e.toHex())),selected:t.toHex()})))},load(){const e=z.get("palette",(e=>({colors:e.colors.map((e=>new y(e))),selected:new y(e.selected)})));e&&(U.palette.value=e)}},j=n({}),D={info:a(null),end(){null!==D.info.value&&(D.info.value={...D.info.value,ended:!0})},start(){null!==D.info.value&&(D.info.value={...D.info.value,ended:!1})},async fetch(){const e=await R.info();return D.info.value={...e,cooldown:e.cooldown},e}},F=n({}),L={progress:a(0),reqId:a(0),startTime:a(0),hasCooldown:o((()=>!1)),start(){L.startTime.value=performance.now(),L.reqId.value=requestAnimationFrame(L.update)},update(e){const t=e-L.startTime.value;if(null===D.info.value)return;const a=t/(_.cooldown.offset+(N.isStaff.value?_.cooldown.staff:D.info.value.cooldown));if(a>=1)return L.progress.value=0,void cancelAnimationFrame(L.reqId.value);L.progress.value=100*a,requestAnimationFrame(L.update)}};L.hasCooldown=o((()=>L.progress.value>0));const q=n({}),G={coordinates:a(new h(-1,-1)),areCoordinatesSet:o((()=>!1)),info:a(null),async fetchInfo(){G.info.value=await R.getPixel(G.coordinates.value)},setCoordinates(e){G.coordinates.value=e},removeCoordinates(){G.coordinates.value=new h(-1,-1)}};G.areCoordinatesSet=o((()=>-1!==G.coordinates.value.x));const $=n({}),M={tags:a([]),selectedTag:a(""),async fetch(){const e=await R.tags();if(M.tags.value=e.tags.map(((e,t)=>({name:e[0],pixels:e[1],place:t}))),!N.isAuthenticated.value)return;if(null===N.user.value)return;if(!(null!==N.user.value.tag))return;M.selectedTag.value=N.user.value.tag??"";!M.tags.value.some((e=>e.name===M.selectedTag.value))&&M.pushFakeTag(N.user.value.tag??"???")},pushFakeTag(e){M.tags.value=[...M.tags.value,{name:e,pixels:-1,place:M.tags.value.length}]},purgeFakeTags(){M.tags.value=M.tags.value.filter((e=>-1!==e.pixels))},select(e){var t;const a=M.selectedTag.value;if(a===e)return;-1===(null==(t=M.tags.value.find((e=>e.name===a)))?void 0:t.pixels)&&M.purgeFakeTags();M.tags.value.find((t=>t.name===e))||M.pushFakeTag(e),M.selectedTag.value=e},selectAndFetch(e){this.select(e),R.changeTag(e).then((()=>N.fetch()))},remove(){M.selectedTag.value="",M.purgeFakeTags(),R.changeTag("").then((()=>N.fetch()))}},J=n({}),H={isEnabled:a(!1),toggle(){H.isEnabled.value=!H.isEnabled.value}},V=n({}),K={settings:a(_.defaults.settings),load(){const e=z.get("settings");e&&(this.settings.value=e)},save(){z.set("settings",this.settings.value??_.defaults.settings)}},W=n({});async function Y(e){const t=new FileReader;return new Promise(((a,o)=>{t.onloadend=()=>{"string"==typeof t.result?a(t.result):o()},t.onerror=()=>o(),t.readAsDataURL(e)}))}const Q={image:a(null),imageName:a(null),position:a(null),opacity:a(null),isSet:o((()=>!1)),setImage(e,t,a){Q.image.value=e,Q.imageName.value=t,Q.position.value=a,Q.opacity.value=_.overlay.defaultOpacity,Q.save()},unsetImage(){Q.image.value=null,Q.imageName.value=null,Q.position.value=null,Q.opacity.value=null,Q.save()},async save(){Q.isSet.value?z.set("overlay",{data:await Y(Q.image.value.raw),name:Q.imageName.value,position:{x:Q.position.value.x,y:Q.position.value.y},opacity:Q.opacity.value??_.overlay.defaultOpacity}):z.reset("overlay")},async load(){const e=z.get("overlay");e&&(Q.image.value=await new b(await async function(e){return(await fetch(e)).blob()}(e.data)).process(),Q.position.value=new h(e.position.x,e.position.y),Q.imageName.value=e.name,Q.opacity.value=e.opacity??_.overlay.defaultOpacity)}};Q.isSet=o((()=>null!==Q.image.value));const X=n({}),Z={modal:a(null),isOpen:o((()=>!1)),open(e,t){Z.modal.value={title:e,children:t}},close(){Z.modal.value=null}};Z.isOpen=o((()=>null!==Z.modal.value));const ee=n({}),te={background:"_background_1uywn_1",modal:"_modal_1uywn_13",top:"_top_1uywn_24",title:"_title_1uywn_31",close:"_close_1uywn_36",body:"_body_1uywn_40"};function ae({className:e,icon:t,alt:a,size:o=15,viewBoxSize:n=17}){return i("svg",{className:e,alt:a,width:o,height:o,viewBox:`0 0 ${n} ${n}`,children:i("use",{href:`/images/icons/minify/${t}.min.svg#icon`})})}function oe(){var e,t;const a=s(ee);return a.isOpen.value?i("div",{className:te.background,children:i("div",{className:te.modal,children:[i("div",{className:te.top,children:[i("h3",{className:te.title,children:null==(e=a.modal.value)?void 0:e.title}),i("button",{className:te.close,onClick:()=>a.close(),children:i(ae,{icon:"plus"})})]}),i("div",{className:te.body,children:null==(t=a.modal.value)?void 0:t.children})]})}):null}const ne=r((()=>g((()=>import("./Snow-xd8wy1gf.js")),__vite__mapDeps([0,1,2,3])).then((e=>e.Snow)))),ie=r((()=>g((()=>import("./Place-W8ubVi-x.js")),__vite__mapDeps([4,1,2,5,6])).then((e=>e.Place)))),se=r((()=>g((()=>import("./TopBar-Bqr--zDD.js")),__vite__mapDeps([7,1,2,5,8])).then((e=>e.TopBar))));function le(){return i(l,{children:[i(W.Provider,{value:K,children:i(ne,{})}),i(F.Provider,{value:D,children:i(V.Provider,{value:H,children:i(O.Provider,{value:B,children:i(X.Provider,{value:Q,children:[i(ie,{}),i(A.Provider,{value:T,children:i(J.Provider,{value:M,children:i(ee.Provider,{value:Z,children:[i(oe,{}),i(k.Provider,{value:N,children:i($.Provider,{value:G,children:i(q.Provider,{value:L,children:i(j.Provider,{value:U,children:i(se,{})})})})})]})})})]})})})})]})}const re={wrapper:"_wrapper_13eau_1",title:"_title_13eau_12",container:"_container_13eau_19",link:"_link_13eau_27",message:"_message_13eau_31"};function ce(){return i("div",{className:re.container,children:i("section",{className:re.wrapper,children:[i("h1",{className:re.title,children:"Страница не найдена"}),i("p",{className:re.message,children:"Возможно вы перешли по неправильному адресу"}),i("a",{href:"/",className:re.link,children:"Вернуться на главную"})]})})}function ue(){const e=new URLSearchParams({client_id:_.discord.clientId,redirect_uri:_.discord.redirectUri,response_type:"code",scope:_.discord.scope.join(" ")});return c((()=>{window.location.replace(`https://discord.com/api/oauth2/authorize?${e}`)})),null}function de(){return c((()=>{N.logout(),window.location.replace("/")}),[]),null}const pe="_wrapper_1xbj9_1",ve="_logo_1xbj9_25",fe="_message_1xbj9_39";function he(){return i(v,{fallback:i("div",{className:pe,children:[i("img",{className:ve,src:"/images/meta/favicon.svg",alt:"Логотип Pixel Battle"}),i("p",{className:fe,children:"Загрузка"})]}),children:i(d,{children:[i(p,{path:"/",component:le}),i(p,{path:"/login",component:ue}),i(p,{path:"/logout",component:de}),i(p,{path:void 0,component:ce})]})})}u(i(he,{}),document.getElementById("app"));export{y as A,H as C,D as I,ee as M,T as N,Q as O,B as P,W as S,J as T,x as U,U as a,E as b,_ as c,L as d,N as e,R as f,G as g,O as h,q as i,j,ae as k,V as l,$ as m,k as n,A as o,X as p,b as q,w as r,F as s};
