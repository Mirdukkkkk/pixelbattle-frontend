const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Snow-DXuoSi8v.js","assets/preact-DoPIZWeU.js","assets/render-D473Hyb3.js","assets/Snow-BJfsKG8O.css","assets/Place-DQiV3Z4P.js","assets/snapshot-C2HsqeCW.js","assets/Place-CCdJ0iqm.css","assets/TopBar-DCAcvf6E.js","assets/TopBar-DvYkkDv6.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,o)=>((t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o)(t,"symbol"!=typeof a?a+"":a,o);import{d as a,w as o,G as n,u as i,x as s,F as l,y as r,B as c,S as u,R as d,L as p}from"./preact-DoPIZWeU.js";import{C as v,P as f}from"./render-D473Hyb3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const h={},m=function(e,t,a){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));o=Promise.all(t.map((e=>{if((e=function(e){return"/"+e}(e))in h)return;h[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,a&&n.setAttribute("nonce",a),document.head.appendChild(n),t?new Promise(((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}return o.then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))};class g extends v{constructor(e){super(e)}equals(e){return this.toNumber()===e.toNumber()}getReadableColor(){const[e,t,a]=this.toUint8RgbArray();return new g(.299*e+.587*t+.114*a>186?"black":"white")}static getRandom(){return new g(Math.floor(16777215*Math.random()))}}var y=(e=>(e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e))(y||{});class w{constructor(e,a=4){t(this,"_buffer"),t(this,"_size"),this._raw=e,this.bufferPixelDataSize=a}convertRGBAtoRGB(e,{x:t,y:a}){const o=new Uint8ClampedArray(t*a*3);for(let n=0,i=0;n<e.length;n+=4,i+=3)o[i]=e[n],o[i+1]=e[n+1],o[i+2]=e[n+2];return o}async process(){const e=await createImageBitmap(this._raw),t=document.createElement("canvas"),a=t.getContext("2d");t.width=e.width,t.height=e.height,a.drawImage(e,0,0);const o=a.getImageData(0,0,t.width,t.height).data;return this._size=new f(e.width,e.height),this._buffer=3===this.bufferPixelDataSize?this.convertRGBAtoRGB(o,this._size):o,this}get raw(){return this._raw}get buffer(){return this._buffer}get size(){return this._size}getPixel(e){const t=e.x+e.y*this._size.x,[a,o,n,...i]=this._buffer.slice(t*this.bufferPixelDataSize,t*this.bufferPixelDataSize+this.bufferPixelDataSize);return new g(new Uint8Array([a,o,n,0===i.length?255:i[0]]))}setPixel(e,t){const a=(e.x+e.y*this._size.x)*this.bufferPixelDataSize,[o,n,i]=t.toUint8RgbArray();this._buffer[a]=o,this._buffer[a+1]=n,this._buffer[a+2]=i}}const b={defaults:{colors:{background:new g("#282828"),palette:{colors:[new g("#ff0000"),new g("#00ff00"),new g("#0000ff"),new g("#000000"),new g("#ffffff")],selected:new g("#ffffff")}},settings:{enableSnow:!0}},time:{update:{tags:3e4,info:3e4},ws:2e3,shake:200,notificationRemoved:3e3,pixelInfo:500},cooldown:{offset:50,staff:50},shakeAmount:.1,zoom:{defaultLevel:.25,maxLevel:3,minLevelPx:5},discord:{clientId:"970714810905936022",redirectUri:"https://api.pixelbattle.fun/login",scope:["identify","guilds.join","email"]},hover:{outlineSize:.1,scale:1.2},url:{api:"https://api.pixelbattle.fun"},snow:{size:2,amount:100},overlay:{defaultOpacity:60},media:{youtube:["https://youtube.pixelbattle.fun","YouTube канал Pixelate It!"],discord:["https://discord.pixelbattle.fun","Discord-сервер Pixelate It!"],github:["https://github.pixelbattle.fun","GitHub Pixelate It!"],help:["https://help.pixelbattle.fun","Страница помощи"]}};var _=(e=>(e[e.User=0]="User",e[e.Moderator=1]="Moderator",e[e.Admin=2]="Admin",e))(_||{});
/*! js-cookie v3.0.5 | MIT */function x(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)e[o]=a[o]}return e}var P=function e(t,a){function o(e,o,n){if("undefined"!=typeof document){"number"==typeof(n=x({},a,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var s in n)n[s]&&(i+="; "+s,!0!==n[s]&&(i+="="+n[s].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+i}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],o={},n=0;n<a.length;n++){var i=a[n].split("="),s=i.slice(1).join("=");try{var l=decodeURIComponent(i[0]);if(o[l]=t.read(s,l),e===l)break}catch(r){}}return e?o[e]:o}},remove:function(e,t){o(e,"",x({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,x({},this.attributes,t))},withConverter:function(t){return e(x({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});class S{static get(e){return P.get(e)}static set(e,t){P.set(e,t)}static remove(e){P.remove(e,{domain:this.url})}static clear(){Object.keys(P.get()).forEach((e=>P.remove(e,{domain:this.url})))}}t(S,"url",(b.url.api.split("//")[1].includes(":")?"":".")+b.url.api.split("//").slice(-1)[0].split(":")[0].split(".").slice(-2).join("."));const C={user:a(null),profile:a(null),isAuthenticated:o((()=>!1)),isBanned:o((()=>!1)),isStaff:o((()=>!1)),load(){const e=S.get("token"),t=S.get("userid");e&&t&&(C.profile.value={token:e,id:t})},async fetch(){const e=await E.profile();C.user.value=e},login(e,t){C.profile.value={token:e,id:t}},logout(){C.profile.value=null,C.user.value=null,S.clear()}};C.isAuthenticated=o((()=>!!C.profile.value)),C.isBanned=o((()=>{var e;return!!(null==(e=C.user.value)?void 0:e.banned)})),C.isStaff=o((()=>{var e;return((null==(e=C.user.value)?void 0:e.role)??_.User)>=_.Moderator}));const N=n({}),k={notifications:a([]),addNotification(e){k.notifications.value.length>=5&&(k.notifications.value=k.notifications.value.slice(1)),k.notifications.value=[...k.notifications.value,{...e,id:Math.random().toString()}]},removeNotification(e){k.notifications.value=k.notifications.value.filter((t=>t.id!==e))}},T=n({}),A={UserCooldown:{title:"Кулдаун активен (С)",message:"Подождите пару секунд"},RateLimit:{title:"Рейт лимит (С)",message:"Подождите пару секунд"},TokenBanned:{title:"Аккаунт забанен (С)",message:"Ваш аккаунт забанен"},NotAuthorized:{title:"Необходимо авторизоваться (С)",message:"Вы не вошли в дискорд аккаунт"}},I={Banned:{title:"Аккаунт забанен",message:"Ваш аккаунт забанен"},Cooldown:{title:"Подождите пару секунд",message:"Кулдаун активен"},"Not logged":{title:"Необходимо авторизоваться",message:"Вы не вошли в дискорд аккаунт"},"Game ended":{title:"Ждите новой игры",message:"Игра окончена"},SnapshotSuccess:{title:"Снимок холста",message:"Снимок сохранено в буфер обмена"},SnapshotFailed:{title:"Снимок холста",message:"Ваш браузер не поддерживает работу с буфером обмена"}};class E{static fetch(e){var t;const a={"Content-Type":"application/json"};return e.withCredentials&&(a.Authorization=`Bearer ${null==(t=C.profile.value)?void 0:t.token}`),fetch(b.url.api+e.url,{method:e.method,headers:"GET"===e.method?void 0:a,body:e.body?JSON.stringify(e.body):void 0}).then((e=>e.json())).then(E.checkForErrors)}static async post(e,t,a=!1){return E.fetch({url:e,method:"POST",withCredentials:a,body:t})}static async put(e,t,a=!1){return E.fetch({url:e,method:"PUT",withCredentials:a,body:t})}static async get(e,t=!1){return E.fetch({url:e,method:"GET",withCredentials:t})}static processError(e){const t=A[e.reason]??{title:"Неизвестная ошибка (С)",message:e.reason};k.addNotification({...t,type:"error"})}static checkForErrors(e){return"error"in e&&e.error?(E.processError(e),Promise.reject(e)):e}static async pixels(){return fetch(b.url.api+"/pixels.png").then((e=>e.blob()))}static async info(){return E.get("/game")}static async profile(){var e;return E.get(`/users/${null==(e=C.profile.value)?void 0:e.id}`)}static async getPixel(e){return E.get(`/pixels?x=${e.x}&y=${e.y}`)}static async tags(){return E.get("/pixels/tag")}static async putPixel(e){return E.put("/pixels",e,!0)}static async changeTag(e){var t;return E.post(`/users/${null==(t=C.profile.value)?void 0:t.id}/tag`,{tag:e},!0)}}const R={image:a(null),container:a({}),async fetch(){const e=await E.pixels();R.image.value=await new w(e,y.RGB).process()}},B=n({});class O{static set(e,t,a=JSON.stringify){localStorage.setItem(e,a(t))}static get(e,t){const a=localStorage.getItem(e);return a?t?t(JSON.parse(a)):JSON.parse(a):void 0}static reset(e){localStorage.removeItem(e)}}const z={palette:a(b.defaults.colors.palette),reset(){z.palette.value=b.defaults.colors.palette,z.save()},setCurrentColor:e=>{z.palette.value={...z.palette.value,selected:e},z.save()},isDefaultColors:()=>z.palette.value.colors.length===b.defaults.colors.palette.colors.length,removeColor(e){z.palette.value={selected:z.palette.value.colors.at(-2)??z.palette.value.selected,colors:z.palette.value.colors.filter((t=>!t.equals(e)))},z.save()},isDefaultColor:e=>b.defaults.colors.palette.colors.some((t=>t.equals(e))),addColor(e){z.palette.value={...z.palette.value,colors:[...z.palette.value.colors,e]},z.save()},addAndSelect(e){z.palette.value.colors.some((t=>t.equals(e)))||this.addColor(e),this.setCurrentColor(e),z.save()},save(){O.set("palette",{colors:z.palette.value.colors,selected:z.palette.value.selected},(({colors:e,selected:t})=>JSON.stringify({colors:e.map((e=>e.toHex())),selected:t.toHex()})))},load(){const e=O.get("palette",(e=>({colors:e.colors.map((e=>new g(e))),selected:new g(e.selected)})));e&&(z.palette.value=e)}},U=n({}),j={info:a(null),end(){null!==j.info.value&&(j.info.value={...j.info.value,ended:!0})},start(){null!==j.info.value&&(j.info.value={...j.info.value,ended:!1})},async fetch(){const e=await E.info();return j.info.value={...e,cooldown:e.cooldown},e}},D=n({}),F={progress:a(0),reqId:a(0),startTime:a(0),hasCooldown:o((()=>!1)),start(){F.startTime.value=performance.now(),F.reqId.value=requestAnimationFrame(F.update)},update(e){const t=e-F.startTime.value;if(null===j.info.value)return;const a=t/(b.cooldown.offset+(C.isStaff.value?b.cooldown.staff:j.info.value.cooldown));if(a>=1)return F.progress.value=0,void cancelAnimationFrame(F.reqId.value);F.progress.value=100*a,requestAnimationFrame(F.update)}};F.hasCooldown=o((()=>F.progress.value>0));const L=n({}),q={coordinates:a(new f(-1,-1)),areCoordinatesSet:o((()=>!1)),info:a(null),async fetchInfo(){q.info.value=await E.getPixel(q.coordinates.value)},setCoordinates(e){q.coordinates.value=e},removeCoordinates(){q.coordinates.value=new f(-1,-1)}};q.areCoordinatesSet=o((()=>-1!==q.coordinates.value.x));const G=n({}),$={tags:a([]),selectedTag:a(""),async fetch(){const e=await E.tags();if($.tags.value=e.tags.map(((e,t)=>({name:e[0],pixels:e[1],place:t}))),!C.isAuthenticated.value)return;if(null===C.user.value)return;if(!(null!==C.user.value.tag))return;$.selectedTag.value=C.user.value.tag??"";!$.tags.value.some((e=>e.name===$.selectedTag.value))&&$.pushFakeTag(C.user.value.tag??"???")},pushFakeTag(e){$.tags.value=[...$.tags.value,{name:e,pixels:-1,place:$.tags.value.length}]},purgeFakeTags(){$.tags.value=$.tags.value.filter((e=>-1!==e.pixels))},select(e){var t;const a=$.selectedTag.value;if(a===e)return;-1===(null==(t=$.tags.value.find((e=>e.name===a)))?void 0:t.pixels)&&$.purgeFakeTags();$.tags.value.find((t=>t.name===e))||$.pushFakeTag(e),$.selectedTag.value=e},selectAndFetch(e){this.select(e),E.changeTag(e).then((()=>C.fetch()))},remove(){$.selectedTag.value="",$.purgeFakeTags(),E.changeTag("").then((()=>C.fetch()))}},M=n({}),J={isEnabled:a(!1),toggle(){J.isEnabled.value=!J.isEnabled.value}},H=n({}),V={settings:a(b.defaults.settings),load(){const e=O.get("settings");e&&(this.settings.value=e)},save(){O.set("settings",this.settings.value??b.defaults.settings)}},K=n({});async function W(e){const t=new FileReader;return new Promise(((a,o)=>{t.onloadend=()=>{"string"==typeof t.result?a(t.result):o()},t.onerror=()=>o(),t.readAsDataURL(e)}))}const Y={image:a(null),imageName:a(null),position:a(null),opacity:a(null),isSet:o((()=>!1)),setImage(e,t,a){Y.image.value=e,Y.imageName.value=t,Y.position.value=a,Y.opacity.value=b.overlay.defaultOpacity,Y.save()},unsetImage(){Y.image.value=null,Y.imageName.value=null,Y.position.value=null,Y.opacity.value=null,Y.save()},async save(){Y.isSet.value?O.set("overlay",{data:await W(Y.image.value.raw),name:Y.imageName.value,position:{x:Y.position.value.x,y:Y.position.value.y},opacity:Y.opacity.value??b.overlay.defaultOpacity}):O.reset("overlay")},async load(){const e=O.get("overlay");e&&(Y.image.value=await new w(await async function(e){return(await fetch(e)).blob()}(e.data)).process(),Y.position.value=new f(e.position.x,e.position.y),Y.imageName.value=e.name,Y.opacity.value=e.opacity??b.overlay.defaultOpacity)}};Y.isSet=o((()=>null!==Y.image.value));const Q=n({}),X={modal:a(null),isOpen:o((()=>!1)),open(e,t){X.modal.value={title:e,children:t}},close(){X.modal.value=null}};X.isOpen=o((()=>null!==X.modal.value));const Z=n({}),ee={background:"_background_1uywn_1",modal:"_modal_1uywn_13",top:"_top_1uywn_24",title:"_title_1uywn_31",close:"_close_1uywn_36",body:"_body_1uywn_40"};function te({className:e,icon:t,alt:a,size:o=15,viewBoxSize:n=17}){return i("svg",{className:e,alt:a,width:o,height:o,viewBox:`0 0 ${n} ${n}`,children:i("use",{href:`/images/icons/minify/${t}.min.svg#icon`})})}function ae(){var e,t;const a=s(Z);return a.isOpen.value?i("div",{className:ee.background,children:i("div",{className:ee.modal,children:[i("div",{className:ee.top,children:[i("h3",{className:ee.title,children:null==(e=a.modal.value)?void 0:e.title}),i("button",{className:ee.close,onClick:()=>a.close(),children:i(te,{icon:"plus"})})]}),i("div",{className:ee.body,children:null==(t=a.modal.value)?void 0:t.children})]})}):null}const oe=l((()=>m((()=>import("./Snow-DXuoSi8v.js")),__vite__mapDeps([0,1,2,3])).then((e=>e.Snow)))),ne=l((()=>m((()=>import("./Place-DQiV3Z4P.js")),__vite__mapDeps([4,1,2,5,6])).then((e=>e.Place)))),ie=l((()=>m((()=>import("./TopBar-DCAcvf6E.js")),__vite__mapDeps([7,1,2,5,8])).then((e=>e.TopBar))));function se(){return i(K.Provider,{value:V,children:[i(oe,{}),i(D.Provider,{value:j,children:i(H.Provider,{value:J,children:i(B.Provider,{value:R,children:i(Q.Provider,{value:Y,children:[i(ne,{}),i(T.Provider,{value:k,children:i(M.Provider,{value:$,children:i(Z.Provider,{value:X,children:[i(ae,{}),i(N.Provider,{value:C,children:i(G.Provider,{value:q,children:i(L.Provider,{value:F,children:i(U.Provider,{value:z,children:i(ie,{})})})})})]})})})]})})})})]})}const le={wrapper:"_wrapper_13eau_1",title:"_title_13eau_12",container:"_container_13eau_19",link:"_link_13eau_27",message:"_message_13eau_31"};function re(){return i("div",{className:le.container,children:i("section",{className:le.wrapper,children:[i("h1",{className:le.title,children:"Страница не найдена"}),i("p",{className:le.message,children:"Возможно вы перешли по неправильному адресу"}),i("a",{href:"/",className:le.link,children:"Вернуться на главную"})]})})}function ce(){const e=new URLSearchParams({client_id:b.discord.clientId,redirect_uri:b.discord.redirectUri,response_type:"code",scope:b.discord.scope.join(" ")});return r((()=>{window.location.replace(`https://discord.com/api/oauth2/authorize?${e}`)})),null}function ue(){return r((()=>{C.logout(),window.location.replace("/")}),[]),null}const de="_wrapper_1xbj9_1",pe="_logo_1xbj9_25",ve="_message_1xbj9_39";function fe(){return i(p,{fallback:i("div",{className:de,children:[i("img",{className:pe,src:"/images/meta/favicon.svg",alt:"Логотип Pixel Battle"}),i("p",{className:ve,children:"Загрузка"})]}),children:i(u,{children:[i(d,{path:"/",component:se}),i(d,{path:"/login",component:ce}),i(d,{path:"/logout",component:ue}),i(d,{path:void 0,component:re})]})})}c(i(fe,{}),document.getElementById("app"));export{g as A,J as C,j as I,Z as M,k as N,Y as O,R as P,K as S,M as T,_ as U,z as a,I as b,b as c,F as d,C as e,E as f,q as g,B as h,L as i,U as j,te as k,H as l,G as m,N as n,T as o,Q as p,w as q,y as r,D as s};
